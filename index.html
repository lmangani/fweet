<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Play with Fweet!</title>
  <link href='//fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
  <link rel="icon" href="//fweet.herokuapp.com/favicon.ico" />
  
  <script type='text/javascript' src='//code.jquery.com/jquery-1.9.1.js'></script>
  <script type='text/javascript' src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.16/angular.min.js"></script>
  <script type='text/javascript' src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.16/angular-resource.min.js"></script>
  
<style type='text/css'>
	body {
	    background-color: #f2f2f2;
	    font-family: 'roboto', sans-serif;
	    font-weight: 300;
	    font-size: 16px;
	    color: #555;
	    -webkit-font-smoothing: antialiased;
	}
	textarea {
	    height:50px;
	    width:100%;
	}
	
	label {
	    color: #10a54a;
	    width:100px;
	    margin-top:10px;
	    margin-bottom:10px;
	    clear:both;
	}
	
	input, label {
	    float:left;
	    margin-top:10px;
	}
	button {
	    float:left;
	    margin-top:10px;
	}
	fieldset {
	    border-style: dashed;
	}
	fieldset .content {
	    display: none;
	}
	h1 {
	    margin-bottom: 15px;
	    font-size: 45px;
	    font-weight: 300;
	    letter-spacing: -2px;
	}
	h2 {
	    color: #999999;
	    padding-left: 0;
	    display: block;
	    font-weight: 200;
	}
	.header {
		width: 120%;
    		margin-left: -10px;
		background-color: #3498db;
		color: white;
		margin-top: -20px;
		padding-top: 50px;
	}

</style>
  
</head>
<body ng-app='myApp'>
<div id="header" class="header">
	<div style="width:80%;margin:0 auto;">
	  <h1>Play with Fweet</h1><br/>
	</div>
</div>
<div style="width:80%;margin: 0 auto;">
<!--  <img src="//i.imgur.com/HF1daBu.gif" height="100" style="margin-bottom:20px;"><img src="//i.imgur.com/czjXDLf.png"><br/> -->

  <div ng-controller="myCtrl">
    <br>
    <h2>Click on one of the operations below to play with fweet!</h2> 
    <br>
    <fieldset>
        <legend>API: /post/fweet</legend>
        <div class="content_post">
        	<label for="thing" >THING:</label>
        	<input type="text" ng-model="thing" />
		<br />
        	<label for="status" >JSON:</label>
        	<input type="text" ng-model="status"/>
        	<br />
        	<br />	<br />
        	<button ng-click="postData('post/', 1); ">POST Fweet</button>
	</div>
    </fieldset>
    <br />
  	
  	
    <fieldset id="content_get">
        <legend>API: /get/fweet</legend>
        <div class="content">
	        <label for="thing" >THING:</label>
	        <input type="text" ng-model="thing" />
		<br />
	        <br />
	        <button ng-click="getData('get/', 1)">GET Fweets</button>
	</div>
    </fieldset>
    <br />
<!--
    <fieldset>
        <legend>API: /get/latest/fweet</legend>
        <div class="content">
	        <label for="thing" >THING:</label>
	        <input type="text" ng-model="thing" />
		<br />
	        <br />
	        <button ng-click="getData('get/latest/', 1)">GET Request</button>
	</div>
    </fieldset>
    <br />
    
    <fieldset>
        <legend>API: /get/timeline</legend>
        <div class="content">
	        <label for="thing" >THING:</label>
	        <input type="text" ng-model="thing" />
		<br />
	        <br />
	        <button ng-click="getData('get/timeline', 0)">GET Request</button>
	</div>
    </fieldset>
    <br />
-->
     <fieldset id="content_del">
        <legend>API: /del/all/fweets</legend>
        <div class="content">
        	<label for="thing" >THING:</label>
        	<input type="text" ng-model="thing" />
		<br />
        	<br />
        	<button ng-click="getData('del/all/', 1)">DEL Fweets</button>
	</div>
    </fieldset>
    <br />
    
    <label for="echo">Status</label>
    <textarea name="echo" ng-model="response" disabled="disabled" style="height:20px;"></textarea>
    <label for="full">Response</label>
    <textarea name="full" ng-model="fullResponse" disabled="disabled" style="height:350px;"></textarea>
 </div>
</div>
</div>  
<script type='text/javascript'>//<![CDATA[

$(function(){
    window.navigator.geolocation.getCurrentPosition(function(p){console.log(p);})
    $('legend').click(function(){
        $(this).parent().find('.content').slideToggle();
    });
});

function rnd(minv, maxv){
	if (maxv < minv) return 0;
	return Math.floor(Math.random()*(maxv-minv+1)) + minv;
}
function getName(minlength, maxlength, prefix, suffix)
{
	prefix = prefix || '';
	suffix = suffix || '';
	//these weird character sets are intended to cope with the nature of English (e.g. char 'x' pops up less frequently than char 's')
	//note: 'h' appears as consonants and vocals
	var vocals = 'aeiouyh' + 'aeiou' + 'aeiou';
	var cons = 'bcdfghjklmnpqrstvwxz' + 'bcdfgjklmnprstvw' + 'bcdfgjklmnprst';
	var allchars = vocals + cons;
	//minlength += prefix.length;
	//maxlength -= suffix.length;
	var length = rnd(minlength, maxlength) - prefix.length - suffix.length;
	if (length < 1) length = 1;
	//alert(minlength + ' ' + maxlength + ' ' + length);
	var consnum = 0;
	//alert(prefix);
	/*if ((prefix.length > 1) && (cons.indexOf(prefix[0]) != -1) && (cons.indexOf(prefix[1]) != -1)) {
		//alert('a');
		consnum = 2;
	}*/
	if (prefix.length > 0) {
		for (var i = 0; i < prefix.length; i++) {
			if (consnum == 2) consnum = 0;
			if (cons.indexOf(prefix[i]) != -1) {
				consnum++;
			}
		}
	}
	else {
		consnum = 1;
	}
	
	var name = prefix;
	
	for (var i = 0; i < length; i++)
	{
		//if we have used 2 consonants, the next char must be vocal.
		if (consnum == 2)
		{
			touse = vocals;
			consnum = 0;
		}
		else touse = allchars;
		//pick a random character from the set we are goin to use.
		c = touse.charAt(rnd(0, touse.length - 1));
		name = name + c;
		if (cons.indexOf(c) != -1) consnum++;
	}
	name = name.charAt(0).toUpperCase() + name.substring(1, name.length) + suffix;
	return name;
}
function isJson(str) {
    try {
        JSON.parse(str);
    } catch (e) {
        return false;
    }
    return true;
}
angular.module('myApp', ['ngResource'])
.controller('myCtrl', function ($scope, $http) {
    $scope.queries = [
        {'q': '/get/timeline', 'description': 'Timeline'},
        {'q': '/get/', 'description': 'Get'}
    ];
    
    // Start
    $scope.lat = 0; $scope.lng = 0; 
    $scope.randomid = function(max){ return Math.floor((Math.random() * max) + 1)};
    $scope.status = '{ "test": '+$scope.randomid(999)+', "temp": '+$scope.randomid(45)+', "geo_lat": '+$scope.lat+', "geo_lon": '+$scope.lng+'  }';
    $scope.thing = getName(3, 4, '', '')+'-'+getName(2, 6, '', '');
    $scope.response = [];
    $scope.fullResponse = [];
    
   $scope.getData = function(q,t) {
    	$scope.response = "Please Wait...";
    	$('#content_del').find('.content').slideToggle(); 
    	if (t != 0) { var thing = $scope.thing; } else { var thing = ''; }
        var data = $.param({
            json: JSON.stringify($scope.status)
        });
	        // GETs are simple, 
	        $http({
	          url: "//fweet.herokuapp.com/"+q+thing, 
	          method: "GET", 
	          data: [],
	          // params: JSON.parse($scope.status)
	        }).success(function(data, status) {
	            $scope.response = "GET Response: " + JSON.stringify(data.status);
	            $scope.fullResponse = JSON.stringify(data, null, 3);
	        }); 
    };
    
    $scope.postData = function(q,t) {
        $scope.response = "Please Wait...";
        $('#content_get').find('.content').slideToggle(); 
        // Set the Content-Type 
        $http.defaults.headers.post["Content-Type"] = "application/x-www-form-urlencoded";
        
        // Delete the Requested With Header
        delete $http.defaults.headers.common['X-Requested-With'];
        $http({
          url: "//fweet.herokuapp.com/"+q+$scope.thing, 
          method: "POST", 
          params: JSON.parse($scope.status)
        }).success(function(data, status) {
            $scope.response = "POST Response: " + data;
            $scope.fullResponse = JSON.stringify(data, null, 3);
            // new values
    	    $scope.status = '{ "test": '+$scope.randomid(999)+', "temp": '+$scope.randomid(45)+', "geo_lat": '+$scope.lat+', "geo_lon": '+$scope.lng+'  }';
        });
       
    };
    
    $scope.showPosition = function (position) {
    	
            $scope.lat = position.coords.latitude;
            $scope.lng = position.coords.longitude;
            	console.log('got position', position.coords, $scope.lat, $scope.lng);
            $scope.status = '{ "test": '+$scope.randomid(999)+', "temp": '+$scope.randomid(45)+', "geo_lat": '+$scope.lat+', "geo_lon": '+$scope.lng+'  }';
            $scope.$apply();

    };
    
    $scope.getLocation = function () {
            if (window.navigator.geolocation) {
                window.navigator.geolocation.getCurrentPosition($scope.showPosition);
            }
            else {
                $scope.error = "Geolocation is not supported by this browser.";
            }
     };
     
     $scope.getLocation();
     
});
//]]> 
</script>
</body>
</html>
